{% extends "layout.html" %}
{% block body %}
<script type="text/javascript">
  $(function() {
    var submit_form = function(e) {
      $.getJSON($SCRIPT_ROOT + '/_pull', {}, function(data) {
        var tbody = $('#results tbody').empty(),
          props = ["Connection", "Protocol", "Classification"];
        $.each(data.payloads, function(i, payload) {
          var tr = $('<tr class="info">');
          if (payload["Classification"].toLowerCase() === "normal"){
              tr = $('<tr class="success">');
          } else if (payload["Classification"].toLowerCase() === "anomalous") {
              tr = $('<tr class="danger">');
          }

          $.each(props, function(i, prop) {
            $('<td>').html(payload[prop]).appendTo(tr);
          });
          tbody.append(tr);
        });
      });
      setTimeout(submit_form, 1000);
    };

    $('a#grab').bind('click', submit_form);

    $('input[type=text]').bind('keydown', function(e) {
      if (e.keyCode == 13) {
        submit_form(e);
      }
    });
  });

  setTimeout(submit_form, 1000);
</script>
<div class="center-block">
    <h1>massieve</h1>
        <table class="table" id="results">
                <thead>
                    <tr>
                        <th>Connection</th><th>Protocol</th><th>Classification</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
        </table>
</div>
<p><a href=# class="btn btn-info" role="button" id=grab>See traffic</a></p>
{% endblock %}